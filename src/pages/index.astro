---
import { supabase } from '../db/supabase';
const { data } = await supabase.from("userInformation").select();


let code;
// LINEログイン
const client_id = process.env.LINE_CLIENT_ID;
const redirect_url = "https://line-astro-supabase-87bbqc3c8-takumakoikes-projects.vercel.app/";

const login_url = `https://access.line.me/oauth2/v2.1/authorize?response_type=code&client_id=${client_id}&redirect_uri=${redirect_url}&state=12345abcde&scope=profile%20openid&nonce=09876xyz`
---

<html lang="en">	
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>Astro</title>
	</head>
	<body>
		<main class="container mx-auto p-3">
			<h1 class="font-bold text-2xl mt-10">LINEログイン</h1>
			<p>現在ログインしていません。<br>ログインすると↓にメッセージが表示されます</p>
			
			{code != "" ? 
			// ログインしていない時の表示
				<p>まだログインしていません</p>
				<a href={login_url} class="flex bg-green-400 p-2 justify-center">LINEでログインしてみる</a>
			:
			// ログインしてcode発行されている時の表示
				<p>LINEでログインしています！おめでとう！</p>

				<form action="/ts/userinfo" method="post" class="">
					<div class="name">
						<label for="userName">名前
							<input type="text" id="userName" class="p-1 border-2">
						</label>
					</div>
					<div class="line_user_id">
						<label for="userId">LINEユーザーID
							<input type="text" class="p-1 border-2">
						</label>
					</div>
					<button>データベース挿入</button>
				</form>
			}
			<form action="">
				<h2>自分の情報を取得する</h2>
				<button id="getInfo">GET!</button>
			</form>
			


			{
				<ul>
					{data && data.map((item) => (
						<li>{item.name}</li>
					))}
				</ul>
			}
		</main>
		<script src="../js/login.js"></script>
	</body>
</html>
